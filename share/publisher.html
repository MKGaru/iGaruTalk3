<!DOCTYPE html>
<html>
<head>
  <title>iGaruDesktopCapture</title>
  <script src="https://skyway.io/dist/0.3/peer.js"></script>
</head>
<body>
<script>
var peer = new Peer({key: 'c08e7ef5-80a6-40b7-9671-5156cbf83598'});
peer.on('open', function(id) {
  var url = 'http://talk.igaru.com/share/#!/'+ id;
  var target = parent.postMessage ? parent : (parent.document.postMessage ? parent.document : undefined);
  if (typeof target != "undefined") {
    target.postMessage(url, "*");
  }
  window.addEventListener('message', function(event) {
    var streamId = event.data;
    navigator.webkitGetUserMedia(
      {
        audio: { //Note: Audio desktop capture only supported in Chromium in WindowsOS 
          mandatory: {
             chromeMediaSource: "system",
             chromeMediaSourceId: streamId
          }
        },
        video: {
          mandatory: {
            chromeMediaSource: 'desktop', 
            chromeMediaSourceId: streamId, 
            maxWidth: 1920, 
            maxHeight: 1080
          }, 
          optional: []
        }
      },
      function(stream){        
        peer.on('connection', function(connection) {
          peer.call(connection.peer,stream);
        });
      },
      function(err){
        console.error(err);
      }
    );
  },false);
});
</script>
</body>
</html>
